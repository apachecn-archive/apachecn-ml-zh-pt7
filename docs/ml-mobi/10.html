<html><head/><body>


    
        <title>Mobile Application Using Google Vision</title>
        
        <meta charset="utf-8"/>
    

    
        

                            
                    <h1 class="header-title">使用Google Vision的移动应用程序</h1>
                
            
            
                
<p>正如我们在<a href="51fcaf51-eb68-4493-afc2-0b02f1c1d50e.xhtml" target="_blank">第1章</a>、<em>移动机器学习简介、</em>中看到的，我们知道移动应用中的机器学习可以在设备上实现，也可以使用机器学习云提供商服务来实现。有各种机器学习云提供商:</p>
<ul>
<li>克拉里菲</li>
<li>谷歌云愿景</li>
<li>微软Azure认知服务</li>
<li>IBM沃森</li>
<li>亚马逊机器学习</li>
</ul>
<p>在本章中，我们将深入了解Google Cloud Vision，以了解以下内容:</p>
<ul>
<li>谷歌云视觉的特点</li>
<li>如何在Android移动应用中利用谷歌云视觉标签检测技术来确定相机拍摄的照片是什么。也就是说，我们基本上是将一幅图像输入谷歌云视觉，然后看看它是如何给图像贴标签的。Google Vision将预测它从移动应用程序接收到的图像，并为该图像提供一个标签。</li>
</ul>


            

            
        
    






    
        <title>Features of Google Cloud Vision</title>
        
        <meta charset="utf-8"/>
    

    
        

                            
                    <h1 class="header-title">谷歌云视觉的特点</h1>
                
            
            
                
<p>谷歌云视觉API包括各种复杂而强大的机器学习模型，有助于执行图像分析。它使用一个易于使用的REST API将图像分为不同的类别。Google Cloud Vision提供的重要功能包括:</p>
<ul>
<li><strong>标签检测</strong>:这使我们能够将图像分成数千种类别。这些图像可以分为各种常见的类别标签，如<em>动物</em>和<em>水果</em>。</li>
<li><strong>图像属性检测</strong>:这使我们能够从图像中检测单个对象。它还可以检测突出颜色等属性。</li>
<li><strong>人脸检测</strong>:这使我们能够从图像中检测人脸。如果图像中有多张人脸，可以单独检测每一张。它还可以检测与人脸相关的突出属性，如戴头盔。</li>
<li><strong>徽标检测</strong>:这使我们能够从图像中检测印刷文字。训练可以被检测到的显著标志。</li>
<li><strong>地标检测</strong>:它经过训练，可以检测出著名的地标——自然的和人造的——所以这些都是通过谷歌视觉检测出来的。</li>
<li><strong>光学字符识别</strong>:这有助于检测图像中的文本，即使它们不是英文。这支持多种语言。</li>
<li><strong>显性内容检测</strong>:这有助于识别内容的类型或者内容的情绪，比如<em>暴力</em>或者<em>幽默</em>。它使我们能够通过利用可以构建的元数据信息来执行图像的情感分析。</li>
<li><strong>搜索网页</strong>:在网页上搜索相似的图片。</li>
</ul>
<p>Google Cloud Vision提供的所有这些功能都可以通过调用Google提供的简单RESTful APIs来使用。但是，对于它们的使用来说，使用每个特性都是有代价的。也可以使用特征的组合。定价细节可以在谷歌云视觉网站上找到:<a href="https://cloud.google.com/vision/">https://cloud.google.com/vision/</a>。</p>


            

            
        
    






    
        <title>Sample mobile application using Google Cloud Vision</title>
        
        <meta charset="utf-8"/>
    

    
        

                            
                    <h1 class="header-title">使用Google Cloud Vision的示例移动应用程序</h1>
                
            
            
                
<p>在本节中，我们将使用Google Cloud Vision尝试一个示例Android移动应用程序。我们将从手机摄像头捕捉一张图像，上传到谷歌云视觉，看看它预测的图像是什么。这就要用到Google Cloud Vision的标签检测功能，它决定了上传图片的标签。</p>


            

            
        
    






    
        <title>How does label detection work?</title>
        
        <meta charset="utf-8"/>
    

    
        

                            
                    <h1 class="header-title">标签检测是如何工作的？</h1>
                
            
            
                
<p>Vision API可以检测和提取图像中各种类别的实体信息。标签可以识别物体、位置、活动、动物种类、产品等等。标签仅以英文返回。</p>
<p>标签待定的图像和我们打算使用的Google Vision的功能需要在请求API中发送。该功能可以是谷歌云视觉部分的<em>功能中列出的任何功能，例如标签检测或徽标检测。如果有任何额外的图像上下文需要和图像一起发送，它可以作为一个额外的参数发送。此处提供了请求API JSON格式:</em></p>
<pre>{<br/>  "image": {<br/>    object(Image)// Image which needs to be processed.<br/>  },<br/>  "features": [<br/>    {<br/>      object(Feature) //Google Vision Feature that needs to be invoked.<br/>    }<br/>  ],<br/>  "imageContext": {<br/>    object(ImageContext) //additional image context if required.<br/>  },<br/>}</pre>
<p>图像对象可以是base64编码的字符串，也可以是需要分析的图像的URL。该URL可以是Google云存储图像位置，也可以是可公开访问的图像URL。</p>
<p>对请求的响应将是一个基于所请求特性的注释列表。在我们的例子中，它将是标签注释:</p>
<pre>{<br/> "labelAnnotations": [<br/> {<br/> object(EntityAnnotation)<br/> }<br/> ],<br/> "error": {<br/> object(Status)<br/> },<br/>}</pre>
<p>返回的<kbd>EntityAnnotation</kbd>对象将包含图像的标签、预测分数和其他有用的信息。所有匹配输入图像对象的标签都作为一个带有预测分数的数组列表返回，基于此，我们可以执行应用程序中所需的推理。</p>
<p>现在我们已经了解了标签检测的基本原理，让我们开始创建Android应用程序。</p>


            

            
        
    






    
        <title>Prerequisites</title>
        
        <meta charset="utf-8"/>
    

    
        

                            
                    <h1 class="header-title">先决条件</h1>
                
            
            
                
<p>为了开始探索Google vision并使用Google Vision提供的服务编写一个程序，需要设置以下内容，这样我们就可以动手了:</p>
<ul>
<li>谷歌云平台账户</li>
<li>谷歌云控制台上的一个项目</li>
<li>Android Studio的最新版本</li>
<li>运行Android 5.0或更高版本的手机</li>
</ul>


            

            
        
    






    
        <title>Preparations</title>
        
        <meta charset="utf-8"/>
    

    
        

                            
                    <h1 class="header-title">准备</h1>
                
            
            
                
<p>本节详细介绍了在开始从我们的移动应用程序中使用Google Cloud Vision API之前我们需要完成的关键活动:</p>
<ol>
<li>Google Cloud Vision API应该在Google Cloud控制台中启用，并且应该创建一个将在移动应用程序代码中使用的API密钥。请执行以下步骤来获取云视觉API密钥:<ol>
<li>打开<a href="http://Google%20Cloud%20Vision">cloud.google.com/vision</a>。</li>
<li>转到控制台。如果您没有试用帐户，它会要求您创建一个并完成该过程。</li>
<li>启用计费，这样我们就可以获得300美元的免费点数。一旦我们有了帐户，我们可以去控制台，并完成创建密钥的过程。</li>
<li>从控制台中，创建一个项目。</li>
<li>打开该项目。转到API服务|库搜索cloud vision API。</li>
<li>点击它并启用它。</li>
<li>转到API服务|凭据。</li>
<li>转到凭据| API密钥。</li>
<li>创建API密钥。</li>
<li>复制API密钥；这将在移动应用程序代码中使用。</li>
</ol>
</li>
<li>添加移动客户端应用程序中使用Google Cloud Vision API所需的依赖项。将需要谷歌API客户端，因此这需要添加到客户端项目。这些将需要在Gradle构建文件中指定。具有关键依赖关系的示例Gradle文件如下:</li>
</ol>
<pre style="padding-left: 60px">dependencies {<br/> compile fileTree(include: ['*.jar'], dir: 'libs')<br/> testCompile 'junit:junit:4.12'<br/> compile 'com.android.support:appcompat-v7:27.0.2'<br/> compile 'com.android.support:design:27.0.2'<br/> compile 'com.google.api-client:google-api-client-android:1.23.0' exclude module: 'httpclient'<br/> compile 'com.google.http-client:google-http-client-gson:1.23.0' exclude module: 'httpclient'<br/> compile 'com.google.apis:google-api-services-vision:v1-rev369-1.23.0'<br/>}</pre>


            

            
        
    






    
        <title>Understanding the Application</title>
        
        <meta charset="utf-8"/>
    

    
        

                            
                    <h1 class="header-title">了解应用程序</h1>
                
            
            
                
<p>在本节中，我们将看到源代码的关键流程，以了解Google Vision API如何在Android移动应用程序中工作。</p>
<p>Vision类表示用于云视觉的Google API客户端。第一步是初始化Vision类。我们通过构建器来完成，我们向构建器指定传输机制和要使用的JSON工厂:</p>
<div><pre>Vision.Builder builder = new Vision.Builder(httpTransport, jsonFactory, null); </pre>
<p>下一步是将API键分配给Vision Builder，这样它就可以开始与云API进行交互。我们创建的密钥如下所示:</p>
<div><pre>VisionRequestInitializer requestInitializer = new VisionRequestInitializer(CLOUD_VISION_API_KEY)<br/>builder.setVisionRequestInitializer(requestInitializer);</pre>
<p>最后一步是获得Vision实例，通过它可以调用云API:<br/></p>
<pre>Vision vision = builder.build();<br/></pre>
<p>现在我们要捕捉一张图片，将图片发送到云端API检测其标签。通过相机捕捉图片的代码是常见的Android东西。以下代码详细介绍了如何将图像转换为标签检测的视觉请求:</p>
<div><pre>BatchAnnotateImagesRequest batchAnnotateImagesRequest = new BatchAnnotateImagesRequest();<br/><br/>batchAnnotateImagesRequest.setRequests(new ArrayList&lt;AnnotateImageRequest&gt;() {{ AnnotateImageRequest annotateImageRequest = new AnnotateImageRequest();<br/> // Add the image<br/> Image base64EncodedImage = new Image();<br/> // Convert the bitmap to a JPEG<br/> // Just in case it's a format that Android understands but Cloud Vision<br/> ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); bitmap.compress(Bitmap.CompressFormat.JPEG, 90, byteArrayOutputStream);<br/>byte[] imageBytes = byteArrayOutputStream.toByteArray();<br/>// Base64 encode the JPEG<br/>base64EncodedImage.encodeContent(imageBytes); annotateImageRequest.setImage(base64EncodedImage);<br/>// add the features we want<br/>annotateImageRequest.setFeatures(new ArrayList&lt;Feature&gt;() {{<br/>Feature labelDetection = new Feature(); labelDetection.setType("LABEL_DETECTION"); labelDetection.setMaxResults(MAX_LABEL_RESULTS);<br/>add(labelDetection);<br/>}});<br/>// Add the list of one thing to the request<br/>add(annotateImageRequest);<br/>}});<br/>Vision.Images.Annotate annotateRequest =  vision.images().annotate(batchAnnotateImagesRequest);</pre></div>
</div>
</div>
<p>谷歌云视觉将被称为<strong>异步任务</strong>。将对从API收到的响应进行分析，以用户可读的格式提供数据。以下代码提供了从Google Vision收到的响应的详细信息:</p>
<div><pre> //Formatting the response as a string<br/> private static String convertResponseToString(BatchAnnotateImagesResponse response) {<br/> StringBuilder message = new StringBuilder("I found these things:\n\n"); List&lt;EntityAnnotation&gt; labels = response.getResponses().get(0).getLabelAnnotations();<br/> if (labels != null) {<br/> for (EntityAnnotation label : labels) {<br/> message.append(String.format(Locale.US, "%.3f: %s", label.getScore(), label.getDescription()));<br/> message.append("\n");<br/> }<br/> } else {<br/> message.append("nothing");<br/> }<br/> return message.toString();<br/> }<br/></pre></div>
<p>用户可以查看为图像返回的标签。</p>


            

            
        
    






    
        <title>Output</title>
        
        <meta charset="utf-8"/>
    

    
        

                            
                    <h1 class="header-title">输出</h1>
                
            
            
                
<p>当手机被捕获并发送到vision API时，此部分显示Android应用程序屏幕。输出屏幕中列出了可能的标签:</p>
<p class="CDPAlignCenter CDPAlign"><img src="img/30a0c8ed-bd27-429a-a9a1-fb23cce4d065.png" style="width:19.33em;height:34.42em;"/></p>


            

            
        
    






    
        <title>Summary</title>
        
        <meta charset="utf-8"/>
    

    
        

                            
                    <h1 class="header-title">摘要</h1>
                
            
            
                
<p>在这一章中，我们研究了Google Cloud Vision的工作原理，以及如何毫不费力地从移动应用程序中调用它。我们看到，在没有模型选择和训练的麻烦的情况下，进行复杂的机器学习预测是多么容易。在下一章，我们将探讨机器学习在移动应用领域的未来。</p>


            

            
        
    


</body></html>