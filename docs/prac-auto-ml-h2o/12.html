<html><head/><body><html xmlns:epub="http://www.idpf.org/2007/ops">
<head>
<title>9 </title>

</head>
<body>
<div><div><h1 class="chapter-number" id="_idParaDest-141"><a id="_idTextAnchor186"/> 9</h1>
<h1 id="_idParaDest-142"><a id="_idTextAnchor187"/>探索H2O汽车的各种功能</h1>
<p>除了结合许多<strong class="bold">机器学习</strong> ( <strong class="bold"> ML </strong>)算法和各种功能来训练它们，H2O汽车还具有一些杂项功能，使其成为能够满足各种业务需求的全方位服务。</p>
<p>H2O汽车公司的优势不仅在于其自动训练多种模型的能力，还在于为其他服务和功能提供支持，这些服务和功能对于生产级系统至关重要。</p>
<p>在这一章中，我们将探讨H2O汽车公司的两个独特的特点，这是很好的了解，并可以在需要时非常有用。首先是H2O AutoML与Python中一个流行的ML库scikit-learn的兼容性。我们将探讨如何在scikit-learn实现中使用H2O AutoML，以及它如何为大型scikit-learn社区提供价值。</p>
<p>第二个特点是H2O汽车公司的内置日志系统。这个记录系统在AutoML训练过程中记录有价值的信息。如果您计划在生产中使用H2O AutoML服务，在这种情况下，监控系统的健康状况是重中之重，那么它会特别有用。</p>
<p>在本章中，我们将讨论以下主题:</p>
<ul>
<li>了解scikit中的H2O汽车集成-学习</li>
<li>了解H2O汽车事件记录</li>
</ul>
<p>记住这一点，让我们探索H2O汽车公司的第一个杂项功能与scikit-learn的兼容性。</p>
<h1 id="_idParaDest-143"><a id="_idTextAnchor188"/>技术要求</h1>
<p>对于本章，您将需要以下内容:</p>
<ul>
<li>您首选的web浏览器的最新版本</li>
<li>您选择的<strong class="bold">集成开发环境</strong> ( <strong class="bold"> IDE </strong>)</li>
<li>(可选)Jupyter项目的Jupyter笔记本(<a href="https://jupyter.org/">https://jupyter.org/</a>)</li>
</ul>
<p>本章中进行的所有实验都是在Jupyter笔记本上进行的，以便为您提供更好的可视化输出示例。您可以自由地使用相同的设置。您还可以在任何Python环境中执行相同的实验，因为Python代码在这两种环境中的执行是相同的。</p>
<p>本章的所有代码示例都可以在GitHub上的<a href="https://github.com/PacktPublishing/Practical-Automated-Machine-Learning-on-H2O/tree/main/Chapter%209">https://GitHub . com/packt publishing/Practical-Automated-Machine-Learning-on-H2O/tree/main/Chapter % 209</a>找到。</p>
<h1 id="_idParaDest-144"><a id="_idTextAnchor189"/>了解scikit中的H2O汽车集成-学习</h1>
<p><strong class="bold"> Scikit-learn </strong>是<a id="_idIndexMarker942"/>ML和数据科学领域最常用的开源ML库之一。它是Python编程语言的库，<a id="_idIndexMarker944"/>专注于ML工具函数。它包括执行数学和统计分析的模块、通用ML算法以及训练、测试和评估ML模型的功能。</p>
<p>Scikit-learn最初是由大卫·库尔纳波开发的，最初被称为<strong class="bold">。它是2007年作为谷歌代码之夏项目创建的，后来被同年的Matthieu Brucher作为论文项目。后来，位于法国Rocquencourt的法国计算机科学和自动化研究所的Fabian Pedregosa、Gael Varoquaux、Alexandre Gramfort和Vincent Michel对其进行了重写和进一步开发。Scikit-learn的第一个公开发布版本是在2010年2月1日。</strong></p>
<p>你可以找到更多关于<a id="_idIndexMarker945"/> scikit的细节——在这里学习:<a href="https://scikit-learn.org/stable/">https://scikit-learn.org/stable/</a>。</p>
<p>scikit-learn库建立在以下软件包上:</p>
<ul>
<li><strong class="bold"> NumPy </strong> : NumPy是一个<a id="_idIndexMarker946"/> Python库，用于专门处理<a id="_idIndexMarker947"/>数组。它用于Python中的科学计算，并提供了处理多维数组的<a id="_idIndexMarker948"/>函数。它还在所述阵列上提供多种快速计算数学运算，使其成为数据分析的理想选择。它可以执行数组形状操作、排序、搜索、离散傅立叶变换操作、线性代数和统计。你可以在这里找到更多关于NumPy的细节:https://numpy.org/.</li>
<li><strong class="bold"> SciPy </strong> : SciPy是一个<a id="_idIndexMarker949"/>科学计算库，构建在NumPy的<a id="_idIndexMarker950"/>之上。它提供了先进的科学计算功能。它用于执行图像处理、聚类、梯度优化等操作。Python中的所有数值计算都是由SciPy完成的。你可以在这里找到更多关于SciPy的细节:<a href="https://scipy.org/">https://scipy.org/</a>。</li>
<li><strong class="bold">Matplotlib</strong>:Matplotlib<a id="_idIndexMarker952"/>是一个库，用于从数据创建<a id="_idIndexMarker953"/>可视化。这些可视化涉及各种类型的图形和图表，这些图形和图表依赖于可以容易地表达和可视化解释的计算数据。它可以创建适合在科学研究论文中发表的绘图图表，并创建交互式图表，所有这些图表都可以导出为不同类型的格式。你可以在这里找到更多关于Matplotlib的<a id="_idIndexMarker954"/>细节:<a href="https://matplotlib.org/">https://matplotlib.org/</a>。</li>
</ul>
<p>Scikit-learn经常被数据科学家在进行数据实验时使用。它在进行实验时提供了极大的灵活性，并且由于它的API非常易于使用，所以它通常是执行一般ML功能的首选库。</p>
<p>H2O AutoML可以很容易地与scikit-learn集成。你可以使用H2O AutoML作为scikit-learn估计器和<a id="_idIndexMarker955"/>与其他scikit-learn函数结合使用，以达到两全其美。H2O AutoML使用<a id="_idIndexMarker956"/>H2O . sk learn模块与scikit-learn进行交互。h2o.sklearn模块公开了两个包装函数来执行AutoML:</p>
<ul>
<li><strong class="bold">h2oautomlclarger</strong>:此<a id="_idIndexMarker957"/>功能用于使用H2O AutoML训练分类模型</li>
<li><strong class="bold"> H2OAutoMLRegressor </strong>:此<a id="_idIndexMarker958"/>功能用于使用H2O汽车公司的汽车训练回归模型</li>
</ul>
<p>这些函数接受各种格式的输入数据，比如H2Oframes、NumPy数组，甚至pandas DataFrames。它们还公开了标准的训练和预测API，类似于它们在scikit-learn中的使用方式。这使得scikit-learn能够使用H2O AutoML以及其他scikit-learn组件。</p>
<p>H2O AutoML估值器还保留了其原有的功能，如排行榜和培训信息等。用户仍然可以在scikit-learn中访问这些详细信息，以从AutoML培训中提取信息，用于进一步的实验或分析。</p>
<p>现在我们对scikit-learn库及其用途有了更好的理解，让我们来学习如何在H2O汽车公司使用它。我们将从了解在我们的系统上安装scikit-learn的各种方法开始。</p>
<h2 id="_idParaDest-145"><a id="_idTextAnchor190"/>构建和安装sci kit-了解</h2>
<p>安装scikit-learn <a id="_idIndexMarker959"/>非常容易。在您的系统上安装<a id="_idIndexMarker960"/> scikit-learn有三种不同的方法:</p>
<ul>
<li>安装scikit-learn的最新官方版本</li>
<li>安装Python发行版或操作系统提供的scikit-learn版本</li>
<li>从源代码构建和安装scikit-learn包</li>
</ul>
<p>让我们快速地一个接一个地浏览这些选项，这样我们就有scikit-learn可以和H2O汽车一起使用了。</p>
<h3>安装scikit-learn的最新官方版本</h3>
<p>这个过程<a id="_idIndexMarker961"/>可能会有所不同，这取决于您在系统上使用的Python包管理器的类型<a id="_idTextAnchor191"/>:</p>
<ul>
<li>使用<code>pip</code>包管理器，在您的终端中执行以下命令来安装最新版本的scikit-learn: <pre><strong class="bold">pip install -U scikit-learn</strong></pre><ul><li>以下命令将显示scikit-learn的安装位置及其版本:<pre><strong class="bold">python -m pip show scikit-learn </strong></pre></li></ul></li>
<li>使用<a id="_idIndexMarker962"/>Anaconda或<strong class="bold"> Miniconda </strong>包<a id="_idIndexMarker963"/>管理器，在您的终端中执行<a id="_idIndexMarker964"/>以下命令来安装最新版本的scikit-learn: <pre><strong class="bold">conda create -n sklearn-env -c conda-forge scikit-learn</strong> <strong class="bold">conda activate sklearn-env</strong></pre></li>
</ul>
<p>以下命令将显示您系统上安装的scikit-learn版本:</p>
<pre><strong class="bold">conda list scikit-learn</strong></pre>
<p>您可以使用以下命令导入已安装的scikit-learn模块，以确保它已成功安装，然后显示其版本:</p>
<pre><strong class="bold">python -c "import sklearn; sklearn.show_versions()"</strong></pre>
<p>现在我们知道了如何使用<code>pip</code>、Anaconda和Miniconda安装scikit-learn，让我们看看另一种使用操作系统附带的Python发行版安装它的方法。</p>
<h3>安装sci kit-了解如何使用操作系统的Python发行版</h3>
<p>由于scikit-learn <a id="_idIndexMarker965"/>被开发人员广泛使用，所以它通常与内置的包管理器一起打包在各种Python发行版或操作系统中。这使用户能够直接安装可用的scikit-learn软件包，而无需从互联网上下载。</p>
<p>以下是一些操作系统的列表，这些操作系统自带预打包的scikit-learn版本以及安装该版本的相应终端命令:</p>
<ul>
<li><code>python-scikit-learn</code>。要安装这个库，请执行以下命令:<pre><strong class="bold">sudo pacman -S python-scikit-learn</strong></pre></li>
<li><strong class="bold">Debian/Ubuntu</strong>:Debian Ubuntu发行版将scikit-learn包分成三部分:<ul><li><strong class="bold"> python3-sklearn </strong>:这个<a id="_idIndexMarker968"/>包包含scikit-learn函数的python模块</li><li>python3-sklearn-lib :这个<a id="_idIndexMarker969"/>包包含scikit-learn的底层实现和绑定</li><li><strong class="bold"> python3-sklearn-doc </strong>:这个<a id="_idIndexMarker970"/>包包含scikit-learn的文档</li></ul></li>
</ul>
<p>要安装<a id="_idIndexMarker971"/>这个库，执行以下命令:</p>
<pre><strong class="bold">sudo apt-get install python3-sklearn python3-sklearn-lib python3-sklearn-doc</strong></pre>
<ul>
<li><code>python3-scikit-learn</code>。是<code>Fedora30</code> : <pre><strong class="bold">sudo dnf install python3-scikit-learn</strong></pre>中唯一可用的</li>
<li><code>pkgsrc-wip</code>从<a id="_idIndexMarker974"/>这里:<a href="http://pkgsrc.se/math/py-scikit-learn">http://pkgsrc.se/math/py-scikit-learn</a>。</li>
</ul>
<p>这个过程的缺点是，它通常带有一个老版本的scikit-learn。但是，这可以通过使用相应的软件包管理器将已安装的软件包升级到最新版本来解决。</p>
<h3>从源代码构建和安装scikit-learn包</h3>
<p>想要使用最新实验功能的用户或希望为scikit-learn <a id="_idIndexMarker975"/>做出贡献的用户可以直接构建并安装scikit-learn的最新可用版本。</p>
<p>通过执行以下步骤，您可以构建并安装scikit-learn源代码:</p>
<ol>
<li>使用Git查看GitHub上scikit-learn资源库的最新源代码。scikit-learn知识库可以在这里找到:<a href="https://github.com/scikit-learn/scikit-learn">https://github.com/scikit-learn/scikit-learn</a>。执行以下命令来克隆最新的scikit-learn存储库:<pre><strong class="bold">git clone git://github.com/scikit-learn/scikit-learn.git</strong></pre></li>
<li>使用Python创建一个<a id="_idIndexMarker976"/>虚拟环境，安装<strong class="bold"> NumPy </strong>、<strong class="bold"> SciPy </strong>和<strong class="bold"> Cython </strong>，其中<a id="_idIndexMarker977"/>是<a id="_idIndexMarker978"/> scikit-learn: <pre><strong class="bold">python3 -m venv h2o-sklearn</strong> <strong class="bold">source h2o-sklearn/bin/activate</strong> <strong class="bold">pip install wheel numpy scipy cython</strong></pre>的构建依赖项</li>
<li>通过运行以下命令，使用<code>pip</code>构建项目:<pre><strong class="bold">pip install --verbose --no-build-isolation --editable .</strong></pre></li>
<li>安装完成后，通过运行以下命令检查scikit-learn是否安装正确:<pre><strong class="bold">python -c "import sklearn; sklearn.show_versions()"</strong></pre></li>
</ol>
<p>为了避免与其他软件包冲突，强烈建议在虚拟环境或<a id="_idIndexMarker979"/>conda环境中安装scikit-learn。此外，当安装SciPy和NumPy时，建议<a id="_idIndexMarker980"/>使用<strong class="bold">二进制轮</strong>，因为它们不是从源代码重新编译的。</p>
<h2 id="_idParaDest-146"><a id="_idTextAnchor192"/>使用scikit-learn进行实验</h2>
<p>既然我们<a id="_idIndexMarker981"/>已经成功安装了scikit-learn，那么让我们快速查看一个用于训练模型的scikit-learn的简单实现。以此为参考，我们将探讨如何将H2O汽车整合到其中。</p>
<p>我们将在这个实验中使用的数据集将与我们在本书中使用的相同。这个数据集是使用ML解决分类问题的一个很好的例子。</p>
<p>因此，让我们从使用纯scikit-learn函数实现它开始。</p>
<p>按照以下步骤使用scikit-learn在Python中训练您的ML模型:</p>
<ol>
<li value="1">导入<code>sklearn</code>和<code>numpy</code>库:<pre><strong class="bold">import sklearn</strong> <strong class="bold">import numpy</strong></pre></li>
<li>Iris flower数据集很容易在<code>sklearn</code>库中获得<a id="_idIndexMarker982"/>；它存在于<code>sklearn</code>的数据集子模块中。接下来，通过执行以下命令导入该数据集。让我们更仔细地看看数据帧的内容:<pre><strong class="bold">from sklearn.datasets import load_iris</strong> <strong class="bold">dataframe = load_iris()</strong> <strong class="bold">print(dataframe)</strong></pre></li>
</ol>
<p>您应该得到一个以字典形式显示数据帧内容的输出。让我们研究字典中重要的键-值对，以了解我们正在处理的是什么:</p>
<ul>
<li><code>data</code>:这个<a id="_idIndexMarker983"/>键以多维数组的形式包含数据集的所有特征——即萼片长度、萼片宽度、花瓣长度和花瓣宽度。</li>
<li><code>target_names</code>:此<a id="_idIndexMarker984"/>键包含目标或数据集标签的名称，即Iris-setosa、Iris-versicolour和Iris-virginica。这是一个数组，名称的索引是在数据集的实际内容中使用的数字表示。</li>
<li><code>target</code>:该<a id="_idIndexMarker985"/>键包含数据集的所有目标值，也称为标签值。这也是一个表示目标值的数组，否则该目标值将是表格数据集中的一列。这些值是数字，其中<code>0</code>代表鸢尾，<code>1</code>代表鸢尾-杂色，<code>2</code>代表鸢尾-海滨鸢尾，这取决于它们在<code>target_names</code>中的索引值。</li>
</ul>
<ol>
<li value="3">记住这个<a id="_idIndexMarker986"/>信息，通过执行以下命令将特征和标签提取到单独的变量中:<pre><strong class="bold">features = dataframe.data</strong> <strong class="bold">label = dataframe.target</strong></pre></li>
<li>我们需要将数据集分成两部分——一部分用于训练，另一部分用于测试。与H2O不同，在scikit-learn中，我们将特征和标签视为两个独立的实体。它们应该具有相同的维度长度，以匹配数据内容。要进行这种分割，请执行以下命令:<pre><strong class="bold">from sklearn.model_selection import train_test_split</strong> <strong class="bold">feature_train, feature_test, label_train, label_test = train_test_split(features, label, test_size=0.30, random_state=5)</strong></pre></li>
</ol>
<p>分割功能将要素和标注分割成70%比30%的比例，其中70%的数据用于训练，其余30%用于测试。因此，我们最终总共得到四个数据帧，如下所示:</p>
<ul>
<li><code>feature_train</code>:这个<a id="_idIndexMarker987"/>数据帧包含70%的特征数据用于训练</li>
<li><code>label_train</code>:该<a id="_idIndexMarker988"/>数据帧包含70%用于训练的标签数据</li>
<li><code>feature_test</code>:该<a id="_idIndexMarker989"/>数据帧包含30%的用于测试的特征数据</li>
<li><code>label_test</code>:该<a id="_idIndexMarker990"/>数据帧包含用于测试的30%的标签数据</li>
</ul>
<ol>
<li value="5">一旦训练和测试数据帧准备就绪，声明并初始化用于模型训练的ML算法。Scikit-learn为不同类型的算法提供了单独的库。因为我们正在处理一个分类问题，所以让我们使用<strong class="bold">逻辑回归</strong>算法<a id="_idIndexMarker992"/>来训练一个分类模型。执行以下命令，初始化逻辑回归函数来训练模型:<pre><strong class="bold">from sklearn.linear_model import LogisticRegression</strong> <strong class="bold">logReg = LogisticRegression(solver='lbfgs', max_iter=1000)</strong></pre></li>
<li>现在，让我们使用<code>feature_train</code>和<code>label_train</code>数据集训练一个模型。执行以下功能:<pre><strong class="bold">logReg.fit(feature_train, label_train)</strong></pre></li>
<li>一旦训练完成，我们可以使用相同的逻辑回归对象在<code>feature_test</code>数据框架上进行预测。执行以下命令并打印出预测的输出:<pre><strong class="bold">predictions = logReg.predict(feature_test)</strong> <strong class="bold">print(predictions)</strong></pre></li>
</ol>
<p>您应该会得到类似如下的输出:</p>
<div><div><img alt="Figure 9.1 – Prediction output from scikit-learn logistic regression  " height="56" src="img/B17298_09_001.jpg" width="692"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">图9.1-sci kit-learn逻辑回归的预测输出</p>
<ol>
<li value="8">您还可以通过执行以下命令来测量您的预测的准确性:<pre><strong class="bold">score = logReg.score(feature_test, label_test)</strong> <strong class="bold">print(score)</strong></pre></li>
</ol>
<p>你应该得到大约<code>97.77</code>的精度。</p>
<p>在这个实验中，我们学习了如何使用scikit-learn来导入数据集，执行拆分，然后使用逻辑回归来训练分类模型。但是正如我们在前面的章节中了解到的，有大量的ML算法可供选择。每个人都有自己处理<a id="_idIndexMarker993"/>差异<strong class="bold">和<strong class="bold">偏差</strong>的方式。因此，正如<a id="_idIndexMarker994"/>所料，最明显的问题仍然没有答案:<em class="italic">我们应该使用哪种ML算法？</em></strong></p>
<p>正如我们在这个实验中看到的<a id="_idIndexMarker995"/>, scikit-learn可能对不同的算法有大量的支持，但是从编程的角度来看，训练所有这些算法可能会变得复杂。在这里，我们可以集成H2O AutoML来执行自动化模型训练，以训练所有的ML算法。</p>
<p>既然我们已经对如何使用scikit-learn来训练模型有了一个很好的想法，那么让我们看看如何使用H2O AutoML和scikit-learn。</p>
<h2 id="_idParaDest-147"><a id="_idTextAnchor193"/>在scikit-learn中使用H2O AutoML</h2>
<p>首先，我们将学习如何使用scikit中的<a id="_idIndexMarker996"/>H2O AutoML-学习<a id="_idIndexMarker997"/>使用<code>H2OAutoMLClassifier</code>子模块执行分类。我们将使用Iris数据集使用相同的分类ML问题，并看看我们如何使用H2O AutoML训练多个模型。</p>
<h3>使用H2OAutoMLClassifier进行试验</h3>
<p>按照这些步骤使用scikit-learn用Python训练你的H2O自动分类模型:</p>
<ol>
<li value="1">实施我们在<em class="italic">sci kit-learn</em>部分中遵循的<em class="italic">步骤1 </em>至<em class="italic"> 4 </em>。</li>
<li>在我们在<em class="italic">sci kit-learn</em>部分进行的实验中，在<em class="italic">步骤4 </em>之后，我们通过从<code>sklearn.linear_model</code>导入<code>LogisticRegression</code>子模块来初始化逻辑回归算法。在本实验中，我们将从<code>h2o.sklearn</code>模块中导入<code>H2OAutoMLClassifier</code>子模块，而不是<pre><strong class="bold">from h2o.sklearn import H2OAutoMLClassifier</strong> <strong class="bold">h2o_aml_classifier = H2OAutoMLClassifier(max_models=10, seed=5, max_runtime_secs_per_model=30, sort_metric='logloss')</strong></pre></li>
</ol>
<p>就像我们在前面章节中设置AutoML参数一样，我们已经将<code>max_models</code>设置为<code>10</code>，将<code> max_runtime_secs_per_model</code>设置为<code>30</code>秒，将随机<code>seed</code>值设置为<code>5</code>，将<code>sort_metric</code>设置为<code>logloss</code>。</p>
<ol>
<li value="3">一旦<code>H2OAutoMLClassifier</code>被初始化，你就可以用它来适应——换句话说，训练——你的模型。执行以下命令触发AutoML训练:<pre><strong class="bold">h2o_aml_classifier.fit(feature_train, label_train)</strong></pre></li>
</ol>
<p>首先，程序将检查H2O实例是否已经在localhost:54321上运行。如果没有，那么H2O将启动H2O服务器的一个实例；否则，它将重用已经存在的模型来训练AutoML模型。一旦训练开始，您应该会得到类似如下的输出:</p>
<div><div><img alt="Figure 9.2 – Output from H2O AutoML classifier training  " height="253" src="img/B17298_09_002.jpg" width="1073"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">图9.2-H2O自动分类器训练的输出</p>
<p>从<a id="_idIndexMarker999"/>输出可以看到，H2O首先导入并解析了<strong class="bold">特征_序列</strong>和<strong class="bold">标签_序列</strong>数据帧。然后，它开始自动训练。</p>
<ol>
<li value="4">要查看AutoML训练的结果，您可以通过执行以下命令<pre><strong class="bold">h2o_aml_classifier.estimator.leaderboard</strong></pre>来<a id="_idIndexMarker1000"/>查看H2O <strong class="bold">排行榜</strong></li>
</ol>
<p>您应该会得到类似如下的输出:</p>
<div><div><img alt="Figure 9.3 – H2O AutoML leaderboard  " height="294" src="img/B17298_09_003.jpg" width="753"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">图9.3-H2O汽车排行榜</p>
<ol>
<li value="5">使用相同的H2O自动分类器，您也可以进行预测，如下:<pre><strong class="bold">predictions = h2o_aml_classifier.predict(feature_test)</strong> <strong class="bold">print(predictions)</strong></pre></li>
</ol>
<p>您应该会得到类似如下的输出:</p>
<div><div><img alt="Figure 9.4 – Output of the prediction using H2OAutoMLClassifier  " height="77" src="img/B17298_09_004.jpg" width="755"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">图9.4–使用H2OAutoMLClassifier的预测输出</p>
<p>默认情况下，分类器将使用排行榜上排名最高的模型<a id="_idIndexMarker1001"/>进行预测。</p>
<p>至此，您已经学习了如何在scikit中实现H2O AutoML——学习使用<code>H2OAutoMLClassifier</code>解决分类问题。</p>
<p>既然我们已经很好地了解了如何使用<code>H2OAutoMLClassifier</code>对数据执行分类预测，那么让我们看看如何使用<code>H2OAutoMLRegressor</code>子模块执行回归预测。</p>
<h3>使用H2OAutoMLRegressor进行实验</h3>
<p>现在，让我们看看<a id="_idIndexMarker1002"/>我们如何解决一个<code>H2OAutoMLRegressor</code>。对于这个实验，我们将使用我们之前在第7章 、<em class="italic">使用的红酒质量数据集。</em></p>
<p>按照以下步骤，使用scikit-learn在Python中训练您的H2O AutoML回归模型:</p>
<ol>
<li value="1">实施我们在<em class="italic">sci kit-learn</em>部分中遵循的<em class="italic">步骤1 </em>至<em class="italic"> 4 </em>。</li>
<li>在我们在<em class="italic">实验h2oautomlclarger</em>部分执行的实验中，我们初始化了<code>H2OAutoMLClassifier</code>。由于我们在这个实验中处理回归问题，我们将使用<code>H2OAutoMLRegressor</code>子模块。执行以下命令导入并实例化<code>H2OAutoMLRegressor</code>类对象:<pre><strong class="bold">from h2o.sklearn import H2OAutoMLRegressor</strong> <strong class="bold">h2o_aml_regressor = H2OAutoMLRegressor(max_models=10, max_runtime_secs_per_model=30, seed=5)</strong></pre></li>
<li>一旦<code>H2OAutoMLRegressor</code>被初始化，我们可以触发AutoML来训练我们的<a id="_idIndexMarker1003"/>回归模型。执行以下命令触发AutoML: <pre><strong class="bold">h2o_aml_regressor.fit(feature_train, label_train)</strong></pre></li>
</ol>
<p>模型训练完成后，您应该会得到类似以下内容的输出:</p>
<div><div><img alt="Figure 9.5 – Output from H2O AutoML regressor training  " height="182" src="img/B17298_09_005.jpg" width="752"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">图9.5-H2O汽车回归器培训的输出</p>
<ol>
<li value="4">与<code>H2OAutoMLClassifier</code>类似，您也可以通过执行以下命令在<a id="_idIndexMarker1004"/> H2O <strong class="bold">排行榜</strong>上查看AutoML训练的结果:<pre><strong class="bold">h2o_aml_regressor.estimator.leaderboard</strong></pre></li>
<li>做预测也很容易。您使用同一个<code>H2OAutoMLRegressor</code>对象并调用它的<code>predict</code>方法，同时传递为测试而保留的特性数据集。执行以下命令，使用<code>H2OAutoMLRegressor</code>训练的leader模型进行预测:<pre><strong class="bold">predictions = h2o_aml_regressor.predict(feature_test)</strong> <strong class="bold">print(predictions)</strong></pre></li>
</ol>
<p>您应该会得到预测的结果，如下所示:</p>
<div><div><img alt="Figure 9.6 – Output of the prediction using H2OAutoMLRegressor  " height="417" src="img/B17298_09_006.jpg" width="759"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">图9.6–使用H2OAutoMLRegressor的预测输出</p>
<p><a id="_idIndexMarker1005"/>预测输出是一个包含<code>feature_test</code>数据帧的数组。这就是你如何在scikit中实现H2O AutoML——学习使用<code>H2OAutoMLRegressor</code>解决回归问题。</p>
<p>现在你已经知道如何在scikit-learn中使用H2O AutoML，让我们继续H2O AutoML的下一个杂项特性:事件记录。</p>
<h1 id="_idParaDest-148"><a id="_idTextAnchor194"/>了解H2O汽车事件记录</h1>
<p>由于H2O汽车公司自动化了大部分的ML过程，我们给了机器一些控制权。封装意味着AutoML中所有的复杂性都被隐藏起来，我们只知道H2O AutoML给我们的输入和输出。如果H2O汽车公司有任何问题，它给我们的模型没有意义或不是预期的，那么我们需要更深入地了解汽车公司如何训练模型。因此，我们需要一种方法来跟踪H2O汽车内部发生的事情，以及它是否如预期的那样训练模型。</p>
<p>当<a id="_idIndexMarker1007"/>构建这种旨在用于<a id="_idIndexMarker1008"/>生产的软件系统时，您总是需要一个日志系统来记录信息。软件的虚拟本质使得用户很难在系统进行处理和其他活动时跟踪正在发生的事情。任何失败或问题都可能导致一连串的潜在问题，开发人员最终发现这些问题时可能已经太晚了。</p>
<p>这就是为什么日志系统总是被实现来为您的系统提供支持。您的系统生成的日志有助于开发人员追踪问题的根源，并迅速缓解问题。H2O AutoML还可以生成日志，其中包含训练模型时发生的所有底层处理的元信息。当您让H2O处理所有的ML处理时，您可以使用这些日志来保持某种程度的控制。</p>
<p>AutoML生成两种类型的日志。它们如下:</p>
<ul>
<li><strong class="bold">事件日志</strong>:这些是<a id="_idIndexMarker1009"/>事件日志，随着培训的进行，在AutoML的后端生成。所有的日志被收集并以H2O数据帧的形式呈现。</li>
<li><strong class="bold">训练日志</strong>:这些<a id="_idIndexMarker1010"/>是将训练和预测时间显示为AutoML训练模型的日志，采用键值对字典的形式。训练时间在历元中，主要用于模型训练的后分析。</li>
</ul>
<p>让我们看看如何<a id="_idIndexMarker1011"/>通过一个实际的实现从H2O汽车公司检索这些日志。</p>
<p>按照以下步骤使用H2O AutoML训练模型。然后，我们将学习如何提取日志并理解它们的样子:</p>
<ol>
<li value="1">导入<code>h2o</code>模块，初始化H2O，启动本地H2O服务器:<pre><strong class="bold">import h2o</strong> <strong class="bold">h2o.init()</strong></pre></li>
<li>通过传递您下载数据集的位置来导入Iris数据集:<pre><strong class="bold">data = h2o.import_file("Dataset/iris.data")</strong></pre></li>
<li>设置<a id="_idIndexMarker1012"/>标签和特性:<pre><strong class="bold">label = "C5"</strong> <strong class="bold">features = data.columns</strong> <strong class="bold">features.remove(label)</strong></pre></li>
<li>用参数初始化<a id="_idIndexMarker1013"/> H2O AutoML对象，如下:<pre><strong class="bold">aml = h2o.automl.H2OAutoML(max_models=10, seed = 5)</strong></pre></li>
<li>通过传入用于训练模型的特征列、标签列和数据帧来触发AutoML训练:<pre><strong class="bold">aml.train(x = features, y = label, training_frame = dataframe)</strong></pre></li>
<li>一旦训练完成，您就可以通过使用AutoML对象的<code>event_log</code>属性来查看事件日志。让我们检索日志数据帧，看看它的内容:<pre><strong class="bold">event_logs = aml.event_log</strong> <strong class="bold">print(event_logs)</strong></pre></li>
</ol>
<p>您应该会得到类似如下的输出:</p>
<div><div><img alt="Figure 9.7 – Event log output from H2O AutoML  " height="302" src="img/B17298_09_007.jpg" width="1011"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">图9.7-H2O汽车公司的事件日志输出</p>
<p>类似地，您<a id="_idIndexMarker1014"/>可以通过执行R命令后面的<a id="_idIndexMarker1016"/>来查看R编程语言中的<a id="_idIndexMarker1015"/>事件日志:</p>
<pre><strong class="bold">event_log &lt;- aml@event_log</strong></pre>
<p>事件日志包含以下信息:</p>
<ul>
<li><strong class="bold">时间戳</strong>:这个<a id="_idIndexMarker1017"/>列是特定事件发生的时间。</li>
<li><strong class="bold">级别</strong>:在<a id="_idIndexMarker1018"/>日志系统中，日志通常被划分为某些重要或关键级别。在大多数情况下，根据重要程度等级，级别如下:<ol><li><strong class="bold">致命</strong>:此<a id="_idIndexMarker1019"/>日志级别表示应用程序正面临一个关键问题，需要停止运行并关闭。</li><li><strong class="bold">错误</strong>:此<a id="_idIndexMarker1020"/>日志级别表示应用程序在执行某些功能时面临问题。但是，问题并没有严重到需要关闭应用程序。</li><li><strong class="bold">警告</strong>:这个<a id="_idIndexMarker1021"/>日志级别表示应用程序检测到了一些不寻常的东西，这些东西是无害的，不会影响任何功能。</li><li><strong class="bold">信息</strong>:此<a id="_idIndexMarker1022"/>日志级别表示正常的行为更新，如果需要，可以记录并存储以备将来参考。它们通常信息丰富。</li><li><strong class="bold"> DEBUG </strong>:这个<a id="_idIndexMarker1023"/>日志级别表示开发应用程序时经常需要的更详细的诊断信息，或者在执行诊断操作或调试问题时收集更多信息。</li><li><strong class="bold">跟踪</strong>:这个<a id="_idIndexMarker1024"/>日志级别类似于<strong class="bold">调试</strong>，尽管更详细，尤其是当您在代码库中跟踪信息流时。</li></ol></li>
<li><strong class="bold">阶段</strong>:此<a id="_idIndexMarker1025"/>栏表示生成日志的AutoML训练阶段。</li>
<li><strong class="bold">消息</strong>:该<a id="_idIndexMarker1026"/>列包含一条描述性消息，该消息提供了关于所发生事件的信息。</li>
<li><strong class="bold">名称</strong>:该<a id="_idIndexMarker1027"/>栏包含发生的事件日志的名称(如果设置的话)。</li>
<li><strong class="bold">值</strong>:该<a id="_idIndexMarker1028"/>列包含事件日志的值，如果设置了该值。</li>
</ul>
<ol>
<li value="7">现在，让我们<a id="_idIndexMarker1029"/>检索<a id="_idIndexMarker1030"/>培训日志并查看它们的内容:<pre><strong class="bold">info_logs = aml.training_info</strong> <strong class="bold">print(info_logs)</strong></pre></li>
</ol>
<p>您应该会得到类似如下的输出:</p>
<div><div><img alt="Figure 9.8 – Event log output from H2O AutoML  " height="335" src="img/B17298_09_008.jpg" width="771"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">图9.8-H2O汽车公司的事件日志输出</p>
<p>类似地，您可以通过执行以下R命令来查看R编程语言中的事件日志:</p>
<pre><strong class="bold">info_logs &lt;- aml@training_info</strong></pre>
<p>培训日志包含以下信息:</p>
<ul>
<li><code>creation_epoch</code>:训练日志字典中的<a id="_idIndexMarker1033"/>键包含创建AutoML作业时的纪元值。</li>
<li><code>start_epoch</code>:训练日志字典中的这个<a id="_idIndexMarker1034"/>键包含AutoML构建开始时的纪元值。</li>
<li><code>start_{model_name}</code>:训练日志字典中的这种<a id="_idIndexMarker1035"/>类型的关键字包含特定模型开始训练时的纪元值。</li>
<li><code>stop_epoch</code>:训练日志字典中的<a id="_idIndexMarker1036"/>键包含AutoML构建停止时的纪元值。</li>
<li><code>duration_secs</code>:训练日志字典中的这个<a id="_idIndexMarker1037"/>键包含了AutoML运行的总时间，单位为秒。</li>
</ul>
<p>这个实验<a id="_idIndexMarker1038"/>给了我们一个H2O如何生成日志事件的好例子。当使用H2O AutoML构建一个ML系统时，您可以将这些日志整合到您的日志系统中，以关注H2O AutoML的功能。这将有助于您识别任何可能迅速出现的问题，并使您的模型保持最高的生产质量。如果在培训过程中出现任何问题，在您意外地将有缺陷的模型部署到生产中之前，您会收到警报。</p>
<h1 id="_idParaDest-149"><a id="_idTextAnchor195"/>总结</h1>
<p>在这一章中，我们了解了H2O汽车公司的一些杂七杂八的特点。我们从理解scikit-learn库开始，并对它的实现有所了解。然后，我们看到了如何在scikit-learn实现中使用<code>H2OAutoMLClassifier</code>库和<code>H2OAutoMLRegressor</code>库来训练AutoML模型。</p>
<p>然后，我们探索了H2O汽车公司的日志系统。之后，我们实现了一个简单的实验，其中我们触发了AutoML训练；完成后，我们提取了Python和R编程语言的事件日志和训练日志。然后，我们了解了这些日志的内容，以及这些信息如何有助于我们密切关注H2O AutoML的功能。</p>
<p>在下一章中，我们将进一步关注在生产中使用H2O，以及我们如何使用H2O的模型对象优化来做到这一点。</p>
</div>
<div><div/>
</div>
</div></body>
</html></body></html>